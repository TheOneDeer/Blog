# 前端开发指南

## 快速开始

### 环境信息

- **后端服务地址**：`http://localhost:8080`
- **API前缀**：`/api/v1`
- **认证方式**：JWT Token

### 基础URL配置

```javascript
const API_BASE_URL = 'http://localhost:8080/api/v1';
```

---

## 认证流程

### 1. 用户注册

```javascript
POST /api/v1/users/register
{
  "username": "testuser",
  "password": "password123",
  "email": "test@example.com"
}
```

### 2. 用户登录（获取Token）

```javascript
POST /api/v1/users/login
{
  "username": "testuser",
  "password": "password123"
}

// 返回
{
  "code": 200,
  "data": {
    "token": "eyJhbGci...",
    "expiresIn": 3600
  }
}
```

### 3. 使用Token

**在所有需要认证的接口请求头中添加**：

```javascript
{
  "Authorization": "Bearer YOUR_TOKEN"
}
```

---

## 核心接口

### 文档上传

```javascript
POST /api/v1/documents/upload
Content-Type: multipart/form-data

// Form Data
file: <File对象>
title: "文档标题"
description: "文档描述"
categoryId: 1 (可选)
```

### 文档列表

```javascript
GET /api/v1/documents?page=1&pageSize=10

// 返回分页数据
{
  "data": {
    "total": 100,
    "page": 1,
    "pageSize": 10,
    "documents": [...]
  }
}
```

### 文档详情

```javascript
GET /api/v1/documents/1

// 返回文档详情
{
  "data": {
    "id": 1,
    "title": "...",
    "fileUrl": "...",
    ...
  }
}
```

### 搜索文档

```javascript
GET /api/v1/search?keyword=学习&page=1&pageSize=10
```

### 分类列表

```javascript
GET /api/v1/categories

// 返回
{
  "data": [
    { "id": 1, "name": "技术文档", ... },
    { "id": 2, "name": "学习笔记", ... }
  ]
}
```

---

## 完整示例

### Axios配置

```javascript
import axios from 'axios';

// 创建axios实例
const api = axios.create({
  baseURL: 'http://localhost:8080/api/v1',
  timeout: 5000
});

// 请求拦截器：自动添加Token
api.interceptors.request.use(config => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 响应拦截器：处理错误
api.interceptors.response.use(
  response => response.data,
  error => {
    if (error.response?.status === 401) {
      // Token过期，跳转到登录页
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default api;
```

### API方法封装

```javascript
// user.js
export const userApi = {
  // 注册
  register(data) {
    return api.post('/users/register', data);
  },
  
  // 登录
  login(data) {
    return api.post('/users/login', data);
  },
  
  // 获取用户信息
  getUserInfo() {
    return api.get('/users/info');
  }
};

// document.js
export const documentApi = {
  // 上传
  upload(formData) {
    return api.post('/documents/upload', formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    });
  },
  
  // 列表
  getList(page = 1, pageSize = 10) {
    return api.get(`/documents?page=${page}&pageSize=${pageSize}`);
  },
  
  // 详情
  getById(id) {
    return api.get(`/documents/${id}`);
  },
  
  // 更新
  update(id, data) {
    return api.put(`/documents/${id}`, data);
  },
  
  // 删除
  delete(id) {
    return api.delete(`/documents/${id}`);
  }
};

// category.js
export const categoryApi = {
  // 创建
  create(data) {
    return api.post('/categories', data);
  },
  
  // 列表
  getList() {
    return api.get('/categories');
  },
  
  // 更新
  update(id, data) {
    return api.put(`/categories/${id}`, data);
  },
  
  // 删除
  delete(id) {
    return api.delete(`/categories/${id}`);
  }
};

// search.js
export const searchApi = {
  search(keyword, page = 1, pageSize = 10) {
    return api.get(`/search?keyword=${keyword}&page=${page}&pageSize=${pageSize}`);
  }
};
```

### Vue3组件示例

```vue
<template>
  <div>
    <!-- 上传 -->
    <el-upload
      :action="uploadUrl"
      :headers="headers"
      :data="uploadData"
      @success="handleSuccess"
    >
      <el-button>上传文档</el-button>
    </el-upload>
    
    <!-- 文档列表 -->
    <el-table :data="docList">
      <el-table-column prop="title" label="标题" />
      <el-table-column prop="description" label="描述" />
      <el-table-column label="操作">
        <template #default="{ row }">
          <el-button @click="viewDoc(row)">查看</el-button>
          <el-button @click="deleteDoc(row.id)">删除</el-button>
        </template>
      </el-table-column>
    </el-table>
    
    <!-- 分页 -->
    <el-pagination
      v-model:current-page="currentPage"
      :total="total"
      @current-change="loadDocs"
    />
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import { documentApi } from '@/api/document';

const uploadUrl = '/api/v1/documents/upload';
const headers = { Authorization: `Bearer ${localStorage.getItem('token')}` };
const uploadData = {};
const docList = ref([]);
const currentPage = ref(1);
const total = ref(0);

const loadDocs = async () => {
  const data = await documentApi.getList(currentPage.value);
  docList.value = data.data.documents;
  total.value = data.data.total;
};

const handleSuccess = () => {
  loadDocs();
};

const deleteDoc = async (id) => {
  await documentApi.delete(id);
  loadDocs();
};

onMounted(loadDocs);
</script>
```

---

## 错误处理

```javascript
// 统一错误处理
try {
  const data = await documentApi.getList();
} catch (error) {
  // 根据错误码处理
  if (error.code === 401) {
    // 未登录，跳转到登录页
    router.push('/login');
  } else if (error.code === 403) {
    // 无权限
    ElMessage.error('无权限访问');
  } else if (error.code === 404) {
    // 资源不存在
    ElMessage.error('文档不存在');
  } else {
    // 其他错误
    ElMessage.error(error.message || '操作失败');
  }
}
```

---

## 数据模型

### Document（文档）

```typescript
interface Document {
  id: number;
  title: string;
  description: string;
  fileName: string;
  fileOriginalName: string;
  fileUrl: string;
  fileType: string;
  fileSize: number;
  thumbnail?: string;
  categoryId?: number;
  viewCount: number;
  downloadCount: number;
  createdAt: string;  // ISO 8601格式
  updatedAt: string;
}
```

### Category（分类）

```typescript
interface Category {
  id: number;
  name: string;
  description?: string;
  parentId: number;
  sortOrder: number;
  createdAt: string;
  updatedAt: string;
}
```

---

## 注意事项

1. **Token存储**：建议使用 `localStorage` 或 `sessionStorage`
2. **Token刷新**：Token有效期为1小时，需要重新登录
3. **文件大小**：最大100MB
4. **支持格式**：PDF、DOCX、DOC、TXT
5. **分页**：默认每页10条
6. **时区**：所有时间使用服务器本地时间

---

## 开发建议

1. **环境变量**：建议将API地址配置到环境变量
2. **接口封装**：统一封装API调用逻辑
3. **加载状态**：添加loading状态提示
4. **错误提示**：友好的错误提示信息
5. **表单验证**：前端做基础验证

---

## 测试账号

- **用户名**：testuser
- **密码**：password123

（或自行注册新账号）
