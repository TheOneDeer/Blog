<!-- Generated by SpecStory -->

<!-- cursor Session 66802567-54b7-496d-8360-440b75c357b7 (2025-11-09 10:34Z) -->

# 登录错误原因及解决方案 (2025-11-09 10:34Z)

_**User (2025-11-09 10:33Z)**_

登录报错了  这个是什么原因  详细给我解释一下  这个问题是需要前端修改还是后端修改

---

_**Assistant (default)**_



---


这是 CORS（跨域资源共享）错误。检查后端 CORS 配置：


---

Tool use: **read_file**

Read file: src/main/java/com/theonedeer/myblog/config/WebConfig.java

---

Tool use: **read_file**

Read file: src/main/resources/application.properties

---

Tool use: **codebase_search**

<details>
                <summary>Searched codebase "CORS configuration cross origin headers" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `src/main/resources/application.properties` | L32 |
| `target/classes/application.properties` | L32 |
| `README.md` | L91 |
| `src/main/java/com/theonedeer/myblog/controller/UserController.java` | L53 |
| `pom.xml` | L29-87 |
| `src/main/java/com/theonedeer/myblog/config/WebConfig.java` | L22 |
| `README.md` | L88-176 |
| `src/main/java/com/theonedeer/myblog/controller/CategoryController.java` | L58 |
| `src/main/java/com/theonedeer/myblog/controller/DocumentController.java` | L49 |
| `src/main/java/com/theonedeer/myblog/controller/SearchController.java` | L45 |
| `src/main/java/com/theonedeer/myblog/util/JwtUtil.java` | L71 |
| `src/main/java/com/theonedeer/myblog/controller/DocumentController.java` | L43-99 |
| `README.md` | L174-202 |
| `src/main/java/com/theonedeer/myblog/exception/GlobalExceptionHandler.java` | L37 |
| `src/main/java/com/theonedeer/myblog/service/DocumentService.java` | L23-86 |

</details>

---



---


检查 `LoginRequest` 是否存在：


---

Tool use: **grep**

<details>
<summary>Grep for "LoginRequest" in "src/main/java" • 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `src/main/java\com\theonedeer\myblog\controller\UserController.java` | `import com.theonedeer.myblog.dto.LoginRequest;` | L4 |
| `src/main/java\com\theonedeer\myblog\controller\UserController.java` | `public Result<LoginResponse> login(@RequestBody LoginRequest request) \{` | L37 |
| `src/main/java\com\theonedeer\myblog\service\UserService.java` | `import com.theonedeer.myblog.dto.LoginRequest;` | L3 |
| `src/main/java\com\theonedeer\myblog\service\UserService.java` | `public LoginResponse login(LoginRequest request) \{` | L73 |


</details>

---



---


这是 CORS（跨域资源共享）错误，需要在后端配置。原因与处理如下：

- 原因：前端 `http://localhost:8080` 请求后端 `http://localhost:9080`，属于跨域。浏览器会先发送 OPTIONS 预检请求，后端未返回允许跨域的响应头，导致请求被阻止。
- 处理：在后端添加 CORS 配置，允许来自前端的跨域请求。

在后端添加 CORS 配置：


---

Tool use: **search_replace**


<details><summary>Edit file: src/main/java/com/theonedeer/myblog/config/WebConfig.java</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -3,4 +3,5 @@
  import org.springframework.beans.factory.annotation.Value;
  import org.springframework.context.annotation.Configuration;
+ import org.springframework.web.servlet.config.annotation.CorsRegistry;
  import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
  import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
```

**Chunk 2**
Lines added: 18, lines removed: undefined

```diff
@@ -21,4 +22,22 @@
                  .addResourceLocations("file:" + uploadDir + "/");
      }
+ 
+     /**
+      * 配置CORS跨域支持
+      */
+     @Override
+     public void addCorsMappings(CorsRegistry registry) {
+         registry.addMapping("/api/**")
+                 // 允许的前端地址
+                 .allowedOrigins("http://localhost:8080", "http://localhost:8081")
+                 // 允许的HTTP方法
+                 .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH")
+                 // 允许的请求头
+                 .allowedHeaders("*")
+                 // 允许发送Cookie和认证信息
+                 .allowCredentials(true)
+                 // 预检请求的缓存时间（秒）
+                 .maxAge(3600);
+     }
  }
  
```

</details>

---



---


检查是否有编译错误：


---

Tool use: **read_lints**

<details>
          <summary>Read lints for 1 file</summary>
      
Lint paths:

- `src/main/java/com/theonedeer/myblog/config/WebConfig.java`

Lint results

Lint errors for `src/main/java/com/theonedeer/myblog/config/WebConfig.java`


| Message | Range | Severity |
|-------|-------|----------|
| WebConfig.java is a non-project file, only syntax errors are reported | 1:1-1:2 | DIAGNOSTIC_SEVERITY_WARNING |


</details>

---



---


已修复。以下是说明：

## 问题原因

这是 CORS（跨域资源共享）错误。

### 什么是跨域？
- 前端：`http://localhost:8080`
- 后端：`http://localhost:9080`
- 协议、域名、端口任一不同即为跨域

### 为什么会被阻止？
浏览器的同源策略会阻止跨域请求，除非后端明确允许。当发送跨域请求时：
1. 浏览器先发送 OPTIONS 预检请求
2. 后端需返回允许跨域的响应头
3. 你的后端未配置这些响应头，导致请求被阻止

## 解决方案

已在后端添加 CORS 配置，修改了 `WebConfig.java`：

### 配置说明：
- `allowedOrigins`: 允许的前端地址（`http://localhost:8080`）
- `allowedMethods`: 允许的 HTTP 方法（GET、POST 等）
- `allowedHeaders`: 允许的请求头（`*` 表示全部）
- `allowCredentials`: 允许发送 Cookie 和认证信息（用于 JWT）
- `maxAge`: 预检请求缓存时间

## 下一步

1. 重启后端服务（修改配置后需要重启）
2. 刷新前端页面，重新尝试登录

## 总结

- 问题：后端缺少 CORS 配置
- 修改位置：后端 `WebConfig.java`
- 前端：无需修改

重启后端后，登录应可正常工作。如仍有问题，请告知。

---

